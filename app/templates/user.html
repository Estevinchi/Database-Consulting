{%extends 'layout.html'%} {%block styles%}
<link rel="stylesheet" href="{{url_for('static', filename='css/user.css')}}" />
{%endblock%} {%block favicon%}
<link
  rel="shortcut icon"
  href="{{ url_for('static', filename='img/favicons/bbdd_edit.png') }}"
  type="image/x-icon"
/>
{%endblock%} {%block title%} {{current_user.username}} | Database Example
{%endblock%} {%block body%}
<nav>
  <ul>
    <li>
      <a href="{{ url_for('auth_bp.home') }}">Inicio</a>
    </li>

    {% if current_user.admin %}
    <li>
      <a href="{{ url_for('admin_bp.home_admin') }}">Administrar</a>
    </li>
    {%endif%}
    <li>
      <a href="{{url_for('auth_bp.user')}}">Mi Perfil</a>
    </li>
  </ul>
  <form action="{{url_for('auth_bp.logout')}}" method="post">
    <button type="submit">Cerrar sessión</button>
  </form>
</nav>
<h1>{{current_user.username}}</h1>
<!-- Mostrar mesajes flash  -->
{%with messages = get_flashed_messages(with_categories=true)%} {%if messages%}
<ul>
  {%for category, message in messages%}
  <li class="flash-{{ category }}">{{ message }}</li>
  {%endfor%}
</ul>
{%endif%} {%endwith%}

<div class="btn-container">
  <button
    type="button"
    data-bs-toggle="modal"
    data-bs-target="#staticBackdropPswd"
    data-user-id="{{ current_user.id }}"
    data-username="{{ current_user.username }}"
  >
    Cambiar Contraseña
  </button>
</div>

<!-- Modal para cambiar contraseña -->
<div
  class="modal fade"
  id="staticBackdropPswd"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
  tabindex="-1"
  aria-labelledby="staticBackdropLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">
          Cambio de contraseña - {{current_user.username}}
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form method="post" action="{{url_for('auth_bp.update_password')}}">
          <input
            type="number"
            name="id"
            hidden
            id="idUserPswd"
            value="{{current_user.id}}"
          />
          <div class="pswd-container">
            <input
              type="password"
              name="actual_pswd"
              id="actual_pswd"
              class="password_inpt_change"
              placeholder="Contraseña actual"
              required
            />
            <button type="button" class="view"></button>
          </div>
          <div class="pswd-container">
            <input
              type="password"
              name="password"
              placeholder="Nueva contraseña"
              id="pswd"
              class="password_inpt_change"
              required
            />
            <button type="button" class="view"></button>
          </div>
          <div class="pswd-container">
            <input
              type="password"
              name="password_check"
              placeholder="Repite la contraseña"
              id="pswd-check"
              class="password_inpt_change"
              required
            />
            <button type="button" class="view"></button>
          </div>

          <button type="submit" class="btn btn-primary" data-bs-dismiss="modal">
            Guardar
          </button>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>
<script>
  const inputs = document.querySelectorAll(".password_inpt_change");

  const viewButtons = document.querySelectorAll(".view");

  viewButtons.forEach((btn, index) => {
    btn.innerHTML = `<span class="material-symbols-outlined">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-eye"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" /><path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" /></svg>
    </span>`;

    btn.addEventListener("click", () => {
      const input = inputs[index];

      if (input.type === "password") {
        input.type = "text";
        btn.innerHTML = `<span class="material-symbols-outlined">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-eye"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 4c4.29 0 7.863 2.429 10.665 7.154l.22 .379l.045 .1l.03 .083l.014 .055l.014 .082l.011 .1v.11l-.014 .111a.992 .992 0 0 1 -.026 .11l-.039 .108l-.036 .075l-.016 .03c-2.764 4.836 -6.3 7.38 -10.555 7.499l-.313 .004c-4.396 0 -8.037 -2.549 -10.868 -7.504a1 1 0 0 1 0 -.992c2.831 -4.955 6.472 -7.504 10.868 -7.504zm0 5a3 3 0 1 0 0 6a3 3 0 0 0 0 -6z" /></svg>
        </span>`;
      } else {
        input.type = "password";
        btn.innerHTML = `<span class="material-symbols-outlined">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-eye"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" /><path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" /></svg>
        </span>`;
      }
    });
  });
</script>

{%endblock%}
